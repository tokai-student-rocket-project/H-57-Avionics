# H-57 搭載計器 解析資料

## フライトデータ

回収したデータはこちら  
SDカード [flight.csv](./Log/flight.csv)  
EEPROM [flight_eeprom_raw_recovered.txt](./Log/flight_eeprom_raw_recovered.txt)  
地上局 [ground.txt](./Log/ground.txt)

### 到達高度

速報値: __416.68m__ (X+9.22[sec])  
解析値: __402.14m__ (X+9.22[sec])

解析値は打ち上げ当日の海面気圧及び、該当高度の気温から以下の式を用いて到達高度を求めた。

$$ h=\frac{((\frac{P_{0}}{P})^{\frac{1}{5.257}}-1)\times(T+273.15)}{0.0065} $$

$$ P = 97279.27\text{[Pa] (測定値)} \\ P_{0} = 102340\text{[Pa] (海面気圧, ※1)} \\ T = -3.5\text{[degC] (ジオポテンシャル高度406mでの気温, ※2)} $$

- ※1 [毎日の全国データ一覧表（日別値:2023年03月04日）](https://www.data.jma.go.jp/obd/stats/data/mdrr/synopday/data7.html)
- ※2 [気温・湿度の観測データ(札幌　2023年3月4日9時)](https://www.data.jma.go.jp/obd/stats/etrn/upper/view/daily_uth.php?year=2023&month=3&day=4&hour=9&atm=&point=47412&view=)

![Altitude](./Images/Altitude.png)

### 頂点検知

分離ロジックは以下の二つのパターンがある。

- タイマーによる強制分離
- 頂点検知による通常分離

今回の分離は**タイマーによる強制分離 (X+9.98, 頂点の0.76秒後)** であった。

通常分離が行えなかった理由としては、以下で説明する平滑化の強度が弱く、頂点検知が遅れたことで、安全機構として組み込んだ強制分離が先に動作した。

#### 平滑化について

頂点検知は以下の手順で行われる。

気圧計測 > 高度算出 > 平滑化 > 10回連続降下検知

このうち、平滑化では任意の平滑化定数 a が必要であり、これが頂点検出の感度に影響する。今回は***よくわからんので適当***に a=0.25 とした。

結果としては X+11.09[sec] (頂点の1.87秒後) で連続降下検知数が10を上回っており、強制分離を考慮しない場合、この時間に通常分離が行われていた。

以下の図は高度変化と連続降下検知数を表している。左のH-57搭載モデルではX+11.09[sec] (頂点の1.87秒後)に頂点検知が行われている。右の検知感度を改善したモデルではX+9.57[sec] (頂点の0.35秒後)に頂点検知が行われる。今後の打ち上げでは、改善後のモデルを使うことで、より精度の高い頂点検知を期待できる。

|H-57搭載モデル|感度改善モデル|
|:-:|:-:|
|a = 0.25|a = 0.5|
|閾値 = 10回|閾値 = 5回|
|![ApogeeDetectionBefore](./Images/ApogeeDetectionBefore.png)|![ApogeeDetectionAfter](./Images/ApogeeDetectionAfter.png)|

### 終端速度

終端速度: **14~15[m/s]** (垂直成分のみ)

サンプル間の高度変化を時間変化で割ることで求めた。

詳細は[こちら | VerticalVelocity.csv](./Analysis/VerticalVelocity.csv)

![verticalVelocity](./Images/VerticalVelocity.png)

### 気温

フライトデータでは、気温の測定値が20degC付近を推移している。これは明らかに外気温との乖離がある。

![Temperature](./Images/Temperature.png)

リフトオフ直後の20.5degCから僅かに上昇し続け、分離後からは減少していることがわかる。

原因としては、太陽光によってチューブが温められたことが考えられる。打ち上げ当時の射点は気温が0degC程度で日差しが強い環境であった。電装チューブはほぼ密閉された状態であり、基板に搭載した気温センサが外気温を計測することができなかったと考えられる。

また、気温センサの応答性が低いという問題もある。分離後にチューブ内に外気が流入したことで計測値は減少しているが、応答性はかなり低いことがわかる。

解析時の動作試験では気温センサは正常に動作したが、やはり応答性が低いことを確認した。

今後の改善点としては、機体外に熱電対を露出させる方法がある。

## ハードウェア

### 損傷

基板や実装部品, コネクタ等に損傷は見られなかった。

|ラグの左側|ラグ側|ラグの対面|ラグの右側|
|---|---|---|---|
|![Avionics1](./Images/Avionics1.jpg)|![Avionics2](./Images/Avionics2.jpg)|![Avionics3](./Images/Avionics3.jpg)|![Avionics4](./Images/Avionics4.jpg)|

計器下のベークライト板に損傷を確認した。

ベークライト板の破壊によって計器への衝撃が緩和された可能性がある。

今後は、板材を強度の高いものに変更するか、計器タワーの上下を固定するなど構造的な改善を行う必要がある。

![DamegedBakelite](./Images/DamagedBakelite.jpg)

### SDカード

全てのフライトデータの回収に成功した。

[flight.csv](./Log/flight.csv)  

![SD](./Images/SD.png)

### EEPROM

EEPROMからはX+15.20[sec]以降のデータ読み出しができなかった。(解決済み)

![EEPROM](./Images/EEPROM.jpg)

そこで、EEPROMを全てブレッドボードに移してデータダンプを試みた。

![DataDumping](./Images/DataDumping.jpg)

[flight_eeprom_raw.txt](./Log/flight_eeprom_raw.txt)

バイナリデータはMsgPack規格に準拠している。

710行目 (X+15.199[sec])  
`8 12 CA 41 73 2F 1B 4 16 1 CA 47 BF 6C 70 CA 41 A2 66 66 CA 43 B1 19 8C 7E CA 3E B3 80 4 CA 3E 11 1 5 CA 3F 35 20 2D CA 42 8C DA 89 CA 41 90 63 E7 CA C3 8C EA 25 CA 43 36 A5 B2 CA 42 89 76 B5 CA C2 D2 35 43 CA 40 53 12 FE CA 40 9B 83 33 CA 41 3C 76 2 D 0`  

711行目 (X+15.221[sec])  
`8 12 CA 41 73 89 37 4 17 1 CA 47 BF 6E 32 CA 41 A2 51 EC CA 43 B0 F3 20 CC 7F CA 3E CE 40 4 CA 3E 69 1 4 CA 3F 3A 1 2D CA 42 80 A8 96 CA 41 E6 BB 51 CA C3 92 1 90 CA 43 37 DB F8 CA 42 83 AD D6 CA C2 CE A9 14 CA 40 53 12 FE CA 40 9B F1 6 CA 41 3C 76 2 3E`

解析の結果、X+15.221[sec]以降は1パケットのサイズが大きくなっており、パケットの区切りを示す`0x00`のビットが認識されなかったことがわかった。保存は正常に行えていたため、上記を修正したことで全てのフライトデータ回収に成功した。

[flight_eeprom_raw_recovered.txt](./Log/flight_eeprom_raw_recovered.txt)

### 外部給電

外部給電はアンビリカルケーブルで行い、離床時にコネクタ部分で解放され、同時に内部電源に切り替わる設計である。

離床前は外部給電により 変圧後 12[V] が供給されていた。離床直後も内部電源に切り替わり 変圧後 12[V] が供給されていた。なお、電源切り替え時の瞬電は起こらなかった。

### フライトピン

フライトピン, 外部給電ともに線の破断はなく、コネクタ部分から解放されていた。

![Liftoff](./Images/Liftoff.gif)

## 無線通信

アップリンクでの分離コンフィグ設定は成功した。

### 電波強度

地上局の受信強度RSSIは以下の通りである。

||最小[dBm]|最大[dBm]|
|---|---|---|
|離床前|-95|-91|
|着地前|-117|-94|

いずれの強度でも問題なくダウンリンクを受信することができた。

## 地上局

### GNSS

GNSSは当初、大きな加速度がかかると振り切れる為に位置情報を取得不可能になるという懸念事項があった。
地上局で取得したデータより[GNSSlog](../Telemeter/Analysis/GNSSlog.txt)を確認すると、65行と66行の間でsatellitesの数が12.0から7.0に減少している箇所がありこの付近から[GNSSの示す位置情報](../Telemeter/images/H-57GNSSlog.png)が通常ありえない位置を示していることが分かる。そのためこの間に懸念していた位置情報の取得が不可能になっている時間だと言える。
GNSSの示す位置情報については下記の写真を参考にしていただけると幸いである。

加えて、この写真の11:42:49付近に注目してみるとパラシュート展開後、機体が東の方へ流されていることがわかる。

![GNSS](../Telemeter/images/H-57GNSSlog.png "GNSSログ")

では、位置情報取得までの復帰時間を考察すると、赤色のポイントが示す位置が離床前の位置情報となっており、青色のポイントが示す位置が離床後の位置情報となっている。[GNSSlog](../Telemeter/Analysis/GNSSlog.txt)の66行目から71行目の間を取得不可時間と考えるとその時間は11:42:36~11:42:43の**8秒間（epochTimeより算出）__であることが分かる。また、H-57号機が打ちあがった時間は11:42:33であることからも確かにその__8秒間**は位置情報取得不可時間であることへの裏付けとなる。

---

*いかがでしたか？*
